/* Copyright (C) 2014, Artem Demin (bisma.pro) */
jQuery(document).ready(function() {

/*
jQuery("bis_calcbs_y_point_ui").focus(function(){
  this.blur();
});
*/
  var price_summa = 0;
  var word_normal_30 = 2000;
  var word_zasech_30 = 2200;
  var word_decor_30 = 2400;
  
  var word_normal_40 = 2736;
  var word_zasech_40 = 3200;
  var word_decor_40 = 3360;
  
  var word_normal_60 = 4080;
  var word_zasech_60 = 4400;
  var word_decor_60 = 4800;

  jQuery("#bis_calcbs_y_ui")[0].slide = null;
  jQuery("#bis_calcbs_y_ui").slider({
    orientation: "vertical",
    range: "min",
    min: 1,
    max: 3,
    value: 1,
    step: 1,
    slide: function(event,ui) {
      if (ui.value == 1) jQuery("#bis_calcbs_y_point_ui").val('30');
      if (ui.value == 2) jQuery("#bis_calcbs_y_point_ui").val('40');
      if (ui.value == 3) jQuery("#bis_calcbs_y_point_ui").val('60');
   
      calc_summa();
    }
  });
  jQuery("#bis_calcbs_y_point_ui").val(jQuery("#bis_calcbs_y_ui").slider("value"));
  jQuery("#bis_calcbs_y_point_ui").val('30');
  

  jQuery("#bis_calc_nzd div").click(function(){
    jQuery("#bis_calc_nzd div").removeClass("bis_calc_setshift");
    jQuery("#bis_calc_nzd").attr("data-word-type",jQuery(this).attr("data-word-type"));
    jQuery(this).addClass("bis_calc_setshift");
    if (jQuery(this).hasClass("bis_calc_normal")) jQuery("#bis_calcbs_imagebox img").attr("src","/images/calc/normal2.jpg");
    if (jQuery(this).hasClass("bis_calc_zasech")) jQuery("#bis_calcbs_imagebox img").attr("src","/images/calc/zasech2.jpg");
    if (jQuery(this).hasClass("bis_calc_decor")) jQuery("#bis_calcbs_imagebox img").attr("src","/images/calc/decor2.jpg");
    
    calc_summa();
  });
  
  jQuery('#bis_calc_word').keyup(function(){
    // var v=parseFloat(jQuery('#contentSlider2v').text());
		var word=jQuery('#bis_calc_word').val();
		var numberLetter=0;
		if (word.length!=0){
			for (var i=0; i<word.length; i++){
				if (word[i]!=' ') numberLetter++;
			}
		}
		// var sum=Math.round(numberLetter*v*priceBox[koef]);
		jQuery('#bis_calc_word_cnt').text(' '+numberLetter+declination(' букв',' буква',' буквы',numberLetter));
    jQuery('#bis_calc_word_cnt').attr("data-word-count",numberLetter);
    
		calc_summa();	
	});

  function calc_summa() {
    var summa = 0;
    var wtype = jQuery('#bis_calc_nzd').attr("data-word-type");
    var wrazmer = (jQuery('#bis_calcbs_y_point_ui').val());
    var wcount = parseInt(jQuery('#bis_calc_word_cnt').attr("data-word-count"));
    
    if (wtype == 'normal' && wrazmer == 30 && wcount != 0) summa = word_normal_30 * wcount;
    if (wtype == 'normal' && wrazmer == 40 && wcount != 0) summa = word_normal_40 * wcount;
    if (wtype == 'normal' && wrazmer == 60 && wcount != 0) summa = word_normal_60 * wcount;

    if (wtype == 'zasech' && wrazmer == 30 && wcount != 0) summa = word_zasech_30 * wcount;
    if (wtype == 'zasech' && wrazmer == 40 && wcount != 0) summa = word_zasech_40 * wcount;
    if (wtype == 'zasech' && wrazmer == 60 && wcount != 0) summa = word_zasech_60 * wcount;

    if (wtype == 'decor' && wrazmer == 30 && wcount != 0) summa = word_decor_30 * wcount;
    if (wtype == 'decor' && wrazmer == 40 && wcount != 0) summa = word_decor_40 * wcount;
    if (wtype == 'decor' && wrazmer == 60 && wcount != 0) summa = word_decor_60 * wcount;
    
    if (wrazmer > 0 && wcount != 0) jQuery('#bis_itogo .bis_itogo_price').html(summa+' руб.');
	}
		
	function declination(a, b, c, s) { 
    var words = [a, b, c];
		var index = s % 100; 					 
		if (index >=11 && index <= 14) { index = 0; } 
		else { index = (index %= 10) < 5 ? (index > 2 ? 2 : index): 0; } 
		return(words[index]); 				 
	}
		  
});
